<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="keywords" content="八斗金服">
  <meta name="description" content="八斗金服">
  <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="format-detection" content="telephone=no" />
  <title>账户信息</title>
  <link rel="stylesheet" type="text/css" href="weixin/css/wechat.css" />
  <script src="weixin/js/require.js" data-main="weixin/js/main" defer="defer" async="async" type="text/javascript" charset="utf-8"></script>
  <script>
    window.onload = function() {
      require.config({
        baseUrl: 'weixin/js',
        paths: {
          'jquery': [
            '//cdn.bootcss.com/jquery/1.12.4/jquery.min',
            'lib/jquery/1.12.4/jquery.min'
          ],
          "ImagePicker": "plugins/imagePicker/index",
          "localFileReader": "common/localFileReader",
          'config': 'settings',
          'util': 'common/util',
          'WebView': 'common/WebView',
          'userController': 'controller/userController',
          'appController': 'controller/appController'
        }
      });
      require([
        'jquery', 'ImagePicker', 'localFileReader', 'config', 'util', 'WebView', 'userController', 'appController'
      ], function($, ImagePicker, localFileReader, config, util, WebView, userController, appController) {
        var AlloyFinger = ImagePicker.AlloyFinger,
          AlloyCrop = ImagePicker.AlloyCrop,
          rl = $(window).width() > $(window).height() ? $(window).height() : $(window).width();
        var user = userController.getLoginUserFromLocalStorage();
        user && $('[name="token"]').val(user.getToken());

        userController.loadPortrait(function(imgUrl) {
          $('#portrait img').attr('src', util.replaceResUrlOrigin(imgUrl)).fadeIn(300);
        });

        userController.loadUserAuthResult(function(result) {
          $('#invitecode').html(result.getInvitecode());
          $('#telphone').html(result.getTelphone());
          if (result.getUsername()) {
            $('#username').html(result.getUsername().replace(/^(.{1})(.*)/, function(v, v1, v2) {
                var _v = '';
                $.each(v2.split(''), function() {
                  _v += '*';
                });
                return v1 + _v
              }))
              .next().remove();
          }
          // alert(result.getIsAuth())
          if (result.getIsAuth()) {
            $('#isAuth').html('已认证')
              .next().remove();
          }
          if (result.getInvestusertype()) {
            $('#investusertype').html(result.getInvestusertype());
          }
          var params = {
            backUrl: window.location.href
          };
          $('.account-info').on('click', function(e) {
            e.preventDefault();
            if ($(this).data('action') == 1) {
              window.location = config.BASE_URL + config.PAGE_URI_MAP.REALNAME_AUTH_PAGE + '?' + $.param(params);
            }
          });
          
          appController.risk(function(url) {
	          $('.account-info').on('click', function(e) {
	            e.preventDefault();
	            if ($(this).data('action') == 2) {
	              window.location = util.replaceResUrlOrigin(url+'&type='+result.getInvestusertypeNum());
	            }
	          });
	        });
	        
        });
       
        $('[name="img"]').on('change', function() {
          var _self = this,
            path = $(this).val();
          $('#cover').show(0);
          // 裁切图片
          new AlloyCrop({
            image_src: localFileReader.getImageElementsByObjectURL(_self.files, rl, rl)[0].src,
            width: rl,
            height: rl,
            ok: function(base64, canvas) {
              var _b = base64.replace(/data:image\/[a-zA-Z]{1,4};base64,/, '');
              userController.uploadPortrait(_b, function(res) {
                if(res.getStatus()){
                  $('#portrait img').attr('src', util.replaceResUrlOrigin(res.getData()));
                } else {
                  WebView.msgAlert({
                    msg: res.getMsg()
                  }).show();
                }
              });
              $('[name="img"]').val('');
              $('#cover').hide(0);
              this.destory();
            },
            cancel: function() {
              this.destory();
              $('[name="img"]').val('');
              $('#cover').hide(0);
            }
          });
        });

        $('#portrait img').on('error', function() {
          $(this).attr('src', 'weixin/images/portrait/boy-default@3x.png');
        });

        $('#portrait').on('click', function(e) {
          e.stopPropagation();
          $('[name="img"]').click();
        });

        $('#logout').on('click', function() {
          userController.logout();
        });
      });
    };
  </script>
</head>

<body class="account-info-page gray-bg">
  <div class="account-info-wrapper">
    <div class="head-portrait">
      <span id="portrait" class="head-portrait-wrapper">
      	<img />
			</span>
    </div>
    <div class="cashed-group">
      <span>姓名</span>
      <span class="input-like" id="username"></span>
      <a data-action="1" class="read-more-arrow account-info" href="javascript:void(0);"><span>未实名</span></a>
    </div>
    <div class="cashed-group">
      <span>账号</span>
      <span class="input-like" id="telphone">...</span>
    </div>
    <div class="cashed-group">
      <span>实名认证</span>
      <span class="input-like" id="isAuth"></span>
      <a data-action="1" class="read-more-arrow account-info" href="javascript:void(0);"><span id="isAuth">未认证</span></a>
    </div>
    <div class="cashed-group">
      <span>风险等级评测</span>
      <!--<span class="input-like" id="investusertype"></span>-->
      <a data-action="2" class="read-more-arrow account-info" disabled="disabled" href="javascript:void(0);"><span id="investusertype">去评测</span></a>
    </div>
    <div class="cashed-group">
      <span>邀请码</span>
      <span class="input-like" id="invitecode">...</span>
    </div>
    <div class="btn-group">
      <button id="logout" class="btn btn-primary">安全退出</button>
    </div>
  </div>
  <div id="aaa"><img src="" alt=""></div>
  <div id="cropContainer" class="crop-container">

  </div>
  <form style="display: none" id="portraitForm" method="POST" enctype="multipart/form-data">
    <input type="hidden" name="token" value="" />
    <!--<input type="hidden" name="img" value="" />-->
    <input type="file" name="img" value="" />
  </form>
  <div id="cover" style="display:none;position: absolute;top:0;right:0;bottom:0;left:0;background-color:#000;opacity:.8"></div>
</body>

</html>