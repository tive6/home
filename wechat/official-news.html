<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="keywords" content="八斗金服">
  <meta name="description" content="八斗金服">
  <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="format-detection" content="telephone=no" />
  <title>官方公告</title>
  <link rel="stylesheet" type="text/css" href="weixin/css/wechat.css" />
  <script src="weixin/js/require.js" data-main="weixin/js/main" defer="defer" async="async" type="text/javascript" charset="utf-8"></script>
  <script>
    window.onload = function() {
      require.config({
        baseUrl: 'weixin/js',
        paths: {
          // 外部库／插件
          'jquery': [
            '//cdn.bootcss.com/jquery/1.12.4/jquery.min',
            'lib/jquery/1.12.4/jquery.min'
          ],
          'config': 'settings',
          'swipeLoader': 'common/swipeLoader',
          'appController': 'controller/appController',
          'util': 'common/util'
        }
      });
      require([
          'jquery', 'config', 'swipeLoader', 'appController', 'util'
        ],
        function($, config, swipeLoader, appController, util) {

          var dataCount = 0,
            currentPage = 0,
            noMoreData = false;

          function loadMore(callback, swiper) {
            if (noMoreData) {
              return;
            }
            var options = {
              currentPage: currentPage++,
              pageSize: 10
            };
            appController.getCommuniqueMessage(options, function(result) {
              var list = result.mapCommuniqueMessage;
              if (list.length > 0) {
                dataCount += list.length;
                var html = '';
                $.each(list, function(index, message) {
                  /*var hasReaded = true;
                  if (message.getStatus() === '已读') {
                  	hasReaded = false;
                  	$("#appAbstract").find("span").addClass("read");
                  }*/

                  html +=
                    '<div class="officialAnnouncement-list" data-msgid="' + message.getId() + '">' +
                    '<h2 id="appAbstract">' + message.getAppAbstract() + '</h2>' +
                    '<p>' + message.getOpdateString() + '</p>' +
                    '<div class="officialAnnouncement-banner"><a href="' + message.getUrl() + '"><img src="' + util.replaceResUrlOrigin(message.getAppIcon()) + '" /></a></div>' +
                    '<div class="cashed-group">' +
                    '<span>查看详情</span>' +
                    '<a class="read-more-arrow" href="' + message.getUrl() + '"></a>' +
                    '</div>' +
                    '</div>';
                });
                $('#officialAnnouncement-wrapper').append(html);
                $('#loadMore').one('click', loadMore).fadeIn(600);
              } else {
                noMoreData = true;
                $('#loadMore').html('没有更多消息啦～');
              }
              if (dataCount <= 0) {
                $('body').addClass('no-message');
              }
            });
          };
          loadMore();
        });
    };
  </script>
</head>

<body class="officialAnnouncement-page gray-bg">
  <div class="officialAnnouncement-wrapper">
    <!--<div class="officialAnnouncement-list">
				<h2>八斗金服2017年春节放假安排公告<span>未读</span></h2>
				<p>03.06 17:50</p>
				<div class="officialAnnouncement-banner"><img src="" alt="" /></div>
				<div class="cashed-group">
					<span>查看详情</span>
					<a class="read-more-arrow" href="javascript:void(0);"></a>
				</div>
			</div>-->
    <div id="officialAnnouncement-wrapper"></div>
    <div id="loadMore" class="load-more">加载更多</div>
  </div>
  <div class="no-data-msg">暂时还没有消息</div>
</body>

</html>