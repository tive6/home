<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="keywords" content="八斗金服">
  <meta name="description" content="八斗金服">
  <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="format-detection" content="telephone=no" />
  <title>回款详情</title>
  <link rel="stylesheet" type="text/css" href="weixin/css/wechat.css" />

  <script src="weixin/js/require.js" data-main="weixin/js/main" defer="defer" async="async" type="text/javascript" charset="utf-8"></script>
  <script>
    window.onload = function() {
      require.config({
        baseUrl: 'weixin/js',
        paths: {
          // 外部库／插件
          'jquery': [
            '//cdn.bootcss.com/jquery/1.12.4/jquery.min',
            'lib/jquery/1.12.4/jquery.min'
          ],
          'cookie': [
            '//cdn.bootcss.com/cookie.js/1.1.0/cookie.min',
            'lib/cookie/1.1.0/cookie.min'
          ],
          'config': 'settings',
          'util': 'common/util',
          'investController': 'controller/investController'
        }
      });
      require([
        'jquery', 'cookie', 'config', 'util', 'investController'
      ], function($, cookie, config, util, investController) {
        var bidid = util.getSearchField('bi'),
          orderid = util.getSearchField('oi'),
          record = util.getSearchField('record'),
          //是否是智享计划
          isZX = util.getSearchField('it') == '1';
        var opts = {
          bidId: bidid,
          orderId: orderid
        };

        // 查看合同
        $('#contract').on('click', function() {
          investController.contract({
            orderId: orderid
          }, function(data) {
            window.location.href = data.contractUrl;
          });
        });

        if (record) {
          $(".cashed-group1").hide();
          $(".cashed-group2").show();
          $(".cashed-group3").show();
          $(".settlement-title").html("距离本息结算(天)");
          $("#sumRepayment").hide();
          $("#days").show();
        }
        /* *
         zxsmed	已收利差补偿
         waitingzxsm	待收利差补偿
         principalAndInterestGot	已收本息
         waitingPrincipalAndInterest	未收本息
         subSidy	已收贴息
         waitSubSidy	待收贴息
         waitingGotMoney	待收金额
         sumGotMoney	已收金额
        * */
        investController.repayPlan(opts, function(project) {

          var investMoney = project.getInvestMoney(),// 持有本金
            /* 回款新加字段（20170523） */
            zxsmed = project.getZxsmed(),// 已收利差补偿
            waitingzxsm = project.getWaitingzxsm(),// 待收利差补偿
            wpaig = project.getWpaig(),// 已收本息
            wpai = project.getWpai(),// 未收本息
            subSidy = project.getSubSidy(),// 已收贴息
            waitSubSidy = project.getWaitSubSidy(),// 待收贴息
            waitingGotMoney = project.getWaitingGotMoney(),// 待收金额
            sumGotMoney = project.getSumGotMoney(),// 已收金额
            sumInterest = project.getSumInterest(),// 累计投资收益
            benxi = project.getPrincipalAndInterest(),// 本息
            sumRepayment = project.getSumRepayment(),// 回款总金额
            lichaSum = (parseFloat(zxsmed)+parseFloat(waitingzxsm)).toFixed(2),// 利差和
            tiexiSum = (parseFloat(subSidy)+parseFloat(waitSubSidy)).toFixed(2);// 贴息和

          $('#matchedDate').html(project.getMatchedDate());// 匹配时间
          $('#interestDate').html(project.getInterestDate());// 起息时间
          $('#endDateStr').html(project.getEndDateStr());// 本息结算时间
          $('#sumRepayment').html(sumRepayment);// 回款总金额
          $('#principalAndInterest').html(benxi);// 本息
          $('#subSidy').html(subSidy);// 已收贴息
          $('#repaymentResult').html(project.getRepaymentResult());// 回款结果
          $('#sumInterest').html(sumInterest);// 累计投资收益
          $('.investMoney').html(investMoney);// 持有本金
          $('#money').html(investMoney);// 持有本金
          $('#sumEarn').html(sumRepayment);// 回款总金额
					$('#acountBalance').html(sumRepayment);
          $('#waitingGotMoney').html(waitingGotMoney);
          $('#sumGotMoney').html(sumGotMoney);

          isZX && $('#_lx').html('本息 ' + benxi + ' + 补偿 ' + (subSidy || '0.00')).show();
          var hintStr = '<ul class="clearfix"><li class="border-right"><span>' + sumGotMoney + '</span>已收金额（元）<b class="title-hint interested-box">!</b></li><li><span>' + waitingGotMoney + '</span>待收金额（元）<b class="title-hint interest-box">!</b></li></ul>';
          isZX && $('.matching-wrapper').html(hintStr);

          var holdDays = project.getHoldingdays();
          if (holdDays == -1) {
            $("#days").html('000');
            $('.settlement-title').text('投资已结算(天)');
          } else {
            $("#days").html(project.days);
          }

          var html = '',
            status, statusStr;
          $.each(project.getRepaymentList(), function(index, repayment) {
            status = repayment.getRepaymentstatus();
            statusStr = status == '1' ? '回款已收' : status == '2' ? '未还' : status == '3' ? '失败' : status == '4' ? '作废' : '';
            if (status == '1') {
              html +=
                '<div class="payment-list paymentReleased"><div class="payment-title">' +
                '第<strong>' + repayment.getPeriod() + '</strong>期回款 <strong>' + repayment.getRepaymentDate() + '</strong>' +
                '<span class="payment-status">' + statusStr + '</span></div><ul>' +
                '<li class="border-right"><span class="investMoney">' + investMoney + '</span>回款金额(元)</li><li class="border-right">' +
                '<span>' + repayment.getPrincipal() + '</span>应收本金(元)</li><li><span>' + repayment.getInterest() + '</span>应收利息(元)</li></ul></div>'
            } else {
              html +=
                '<div class="payment-list"><div class="payment-title">' +
                '第<strong>' + repayment.getPeriod() + '</strong>期回款 <strong>' + repayment.getRepaymentDate() + '</strong>' +
                '<span class="payment-status not-released">' + statusStr + '</span></div><ul>' +
                '<li class="border-right"><span class="investMoney">' + investMoney + '</span>回款金额(元)</li><li class="border-right">' +
                '<span>' + repayment.getPrincipal() + '</span>应收本金(元)</li><li><span>' + repayment.getInterest() + '</span>应收利息(元)</li></ul></div>'
            }
          });
 
          var allMoneyStr = '<div class="data-list"><span class="data-left">持有金额（元）：</span><span class="data-right">'+investMoney+'</span></div><div class="data-list"><span class="data-left">投资收益（元）：</span><span class="data-right">'+sumInterest+'</span></div><div class="data-list"><span class="data-left">贴息补偿（元）：</span><span class="data-right">'+tiexiSum+'</span></div>' +
            '<div class="data-list data-licha"><span class="data-left">利差补偿（元）：</span><span class="data-right">'+lichaSum+'</span></div>',
            interestedStr = '<div class="data-list"><span class="data-left">已收本息（元）：</span><span class="data-right">'+wpaig+'</span></div><div class="data-list"><span class="data-left">贴息补偿（元）：</span><span class="data-right">'+subSidy+'</span></div>' +
            '<div class="data-list data-licha"><span class="data-left">利差补偿（元）：</span><span class="data-right">'+zxsmed+'</span></div>',
            interestStr = '<div class="data-list"><span class="data-left">待收本息（元）：</span><span class="data-right">'+wpai+'</span></div><div class="data-list"><span class="data-left">贴息补偿（元）：</span><span class="data-right">'+waitSubSidy+'</span></div>' +
            '<div class="data-list data-licha"><span class="data-left">利差补偿（元）：</span><span class="data-right">'+waitingzxsm+'</span></div>';

          $('.title-hint').on('click', function() {
            if ($(this).hasClass('allMoney-box')) {
              $('.alert-title').text('回款总金额');
              $('.alert-data').html(allMoneyStr);
            }
            if ($(this).hasClass('interested-box')) {
              $('.alert-title').text('已收收益');
              $('.alert-data').html(interestedStr);
            }
            if ($(this).hasClass('interest-box')) {
              $('.alert-title').text('待收收益');
              $('.alert-data').html(interestStr);
              /*waitingzxsm < 0 && $('.data-licha').remove();*/
            }
            zxsmed < 0 && $('.data-licha').remove();
            $('.alert-cont').fadeIn();
            $('.alert-wrapper').fadeIn();
          });
          $('.alert-close').click('click', function() {
            $('.alert-cont').fadeOut();
            $('.alert-wrapper').fadeOut();
          });

          $('.payment-content').prepend(html);
          $('.payment-content .paymentReleased:last .payment-title').prepend('<i class="xin-biao">新</i>');
        });
        
       
      });
    };
  </script>
  <style type="text/css">
    .payment-content {
      margin-bottom: 10px;
    }
    
    .financingPeriod-time span {
      z-index: 10;
    }
    
    .payment-title strong {
      font-weight: 400;
    }
  </style>
</head>

<body class="paymentDetails-page gray-bg">
  <div class="paymentDetails-wrapper">
    <div class="">
      <div class="cashed-group cashed-group1">
        <span>持有本金(元)</span>
        <span class="cashed investMoney"></span>
      </div>
      <div class="cashed-group cashed-group2" style="margin-bottom: 0;display: none;">
        <span>投资金额(元)</span>
        <span class="cashed" id="money"></span>
      </div>
      <div class="cashed-group3" style="margin-bottom: 10px;border-bottom:1px solid #e7e7e7;display: none;">
        <div class="balance-group" style="margin:0;border-bottom: none;">
          <span>回款金额(元)</span>
          <span id="acountBalance" class="balance"></span>
        </div>
        <div style="display: none;font-size: 12px;padding: 0 15px 10px 0;color:rgb(25,200,183);text-align:right;background:#fff;" id="_lx"></div>
      </div>

      <div class="principal-settlement">
        <a href="javascript:" id="contract"><img class="settlement-hetong" src="weixin/images/icons/hetong@3x.png" alt="" /></a>
        <div class="settlement-daysNumber" id="sumRepayment"></div>
        <div class="settlement-daysNumber" id="days" style="display: none;"></div>
        <div class="settlement-title">总回款金额(元)
          <span class="title-hint allMoney-box">!</span>
        </div>

        <!-- 回款总金额 弹出框 -->
        <div class="alert-cont allMoney-box" style="display: none">
          <h2 class="alert-title">回款总金额</h2>
          <div class="alert-body">
            <div class="alert-data"></div>
            <!--<a class="immediate-recharge-btn" href="javascript:">朕知道了</a>-->
          </div>
          <a href="javascript:" style="display: block;padding: 20px 0"><img class="alert-close" width="50" src="./weixin/images/close@2x.png" alt="" /></a>
        </div>
        <!-- 灰色半透明背景层 -->
        <div class="alert-wrapper feedback-alert" style="display: none"></div>

        <div class="matching-wrapper">
          <ul class="clearfix">
            <li class="border-right"><span id="waitingGotMoney"></span>已收金额(元)</li>
            <li><span id="sumGotMoney"></span>待收金额(元)</li>
          </ul>
        </div>


      </div>
      <div class="financing-period">
        <div class="financingPeriod-title">
          <h2>预计匹配期限</h2>
        </div>
        <div class="liebiao clear">
          <ul class="clear">
            <li>
              <span><img src="weixin/images/icons/plan/chenggong@2x.png" /></span>
              <p>
                <i id="matchedDate"></i><br/><b>匹配成功</b>
              </p>
            </li>
            <li>
              <span class="biao-center"><img src="weixin/images/icons/plan/jiesuan8@2x.png" /></span>
              <p>
                <i id="interestDate"></i><br/><b>起息时间</b>
              </p>
            </li>
            <li>
              <span><img src="weixin/images/icons/plan/kaishijixi@2x.png" /></span>
              <p>
                <i id="endDateStr"></i><br/><b>本息结算</b>
              </p>
            </li>
          </ul>
        </div>

      </div>
      <div class="collectionPlan-wrapper clearfix">
        <div class="collection-plan" id="repaymentResult"></div>
        <div class="payment-content">
          <p class="record-prompt">请登录八斗金服官网 <a style="color:#19c8b7;" href="https://www.badoufax.com">www.badoufax.com</a> 查看标的详情</p>
        </div>
      </div>
    </div>
  </div>
</body>

</html>